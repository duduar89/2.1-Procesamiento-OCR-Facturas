# ğŸ“„ VISOR DE FACTURAS MEJORADO - ESPECIFICACIÃ“N ACTUALIZADA

## ğŸ¯ OBJETIVO
Mejorar la visualizaciÃ³n actual de facturas procesadas creando un visor profesional tipo modal que muestre el PDF original junto con los datos extraÃ­dos en un diseÃ±o limpio y moderno.

---

## ğŸ“Š ESTADO ACTUAL vs OBJETIVO

### **âŒ LO QUE TIENES AHORA:**
- âœ… ExtracciÃ³n funcionando (Google Document AI + Edge Function)
- âœ… Datos guardados en `datos_extraidos_facturas`
- âœ… Interface bÃ¡sica que muestra campos extraÃ­dos
- âŒ **SIN PDF visible** - Solo datos en texto plano
- âŒ **DiseÃ±o bÃ¡sico** - No es profesional
- âŒ **Sin contexto visual** - No se ve la factura original
- âŒ **DifÃ­cil de validar** - No puedes verificar si los datos son correctos

### **âœ… LO QUE VAMOS A CREAR:**
- ğŸ¨ **DiseÃ±o profesional** como el ejemplo de Gemini
- ğŸ“„ **PDF visible** al lado de los datos
- ğŸ” **Overlays de confianza** sobre el PDF
- âœï¸ **EdiciÃ³n en tiempo real** de campos
- ğŸ’¾ **Auto-guardado** de correcciones
- ğŸ“± **Responsive** - Funciona en mÃ³vil y desktop

---

## ğŸ—ï¸ NUEVA ARQUITECTURA

### **LAYOUT MEJORADO:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ—‚ï¸ Factura #1301 - MADACO 2019, S.L.U.        [< >] [Ã—]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚  ğŸ“‹ DATOS EXTRAÃDOS              â”‚
â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    ğŸ“„ PDF ORIGINAL      â”‚  â”‚ âœ… Proveedor                â”‚  â”‚
â”‚                         â”‚  â”‚ MADACO 2019, S.L.U.        â”‚  â”‚
â”‚    [overlays colores]   â”‚  â”‚ ğŸ“Š Confianza: 95%          â”‚  â”‚
â”‚                         â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚                         â”‚  â”‚ âš ï¸ CIF                     â”‚  â”‚
â”‚                         â”‚  â”‚ B10824431 [editar]         â”‚  â”‚
â”‚                         â”‚  â”‚ ğŸ“Š Confianza: 70%          â”‚  â”‚
â”‚                         â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚                         â”‚  â”‚ âœ… Total Factura           â”‚  â”‚
â”‚                         â”‚  â”‚ 1.534,39 â‚¬                 â”‚  â”‚
â”‚                         â”‚  â”‚ ğŸ“Š Confianza: 98%          â”‚  â”‚
â”‚  [ğŸ”-] [ğŸ”+] [ğŸ“±]      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ COMPONENTES A CREAR

### **1. MODAL PROFESIONAL**
- **DiseÃ±o**: Similar al estilo limpio del ejemplo
- **TamaÃ±o**: 90% pantalla, centrado
- **Responsive**: Desktop dual / MÃ³vil pestaÃ±as
- **Animaciones**: Suaves de apertura/cierre

### **2. PDF VIEWER (Lado Izquierdo)**
- **PDF.js**: Renderizado completo
- **Zoom**: Botones +/- y scroll
- **NavegaciÃ³n**: Si factura tiene mÃºltiples pÃ¡ginas
- **Calidad**: Alta resoluciÃ³n

### **3. PANEL DE DATOS (Lado Derecho)**
- **DiseÃ±o**: Cards limpias por secciÃ³n
- **Colores**: Verde/Amarillo/Rojo por confianza
- **Iconos**: Para cada tipo de dato
- **EdiciÃ³n**: Click para editar campos

### **4. SISTEMA DE CONFIANZA VISUAL**
- **Verde** (>90%): âœ… + fondo verde claro
- **Amarillo** (70-90%): âš ï¸ + fondo amarillo claro
- **Rojo** (<70%): âŒ + fondo rojo claro + [editar]

---

## ğŸ’¾ ESTRUCTURA DE DATOS MEJORADA

### **API: get-factura-completa**
```json
{
  "factura": {
    "id": "uuid",
    "numero_factura": "1301",
    "fecha_factura": "2024-11-12",
    "proveedor_nombre": "MADACO 2019, S.L.U.",
    "proveedor_cif": "B10824431", 
    "total_factura": 1534.39,
    "base_imponible": 1387.40,
    "cuota_iva": 147.00,
    "tipo_iva": 21,
    "confianza_global": 0.85
  },
  "confianzas": {
    "proveedor_nombre": 0.95,
    "proveedor_cif": 0.70,
    "numero_factura": 0.85,
    "fecha_factura": 0.92,
    "total_factura": 0.98,
    "base_imponible": 0.88
  },
  "pdf_url": "https://storage.supabase.com/bucket/documento.pdf",
  "metadatos": {
    "fecha_procesamiento": "2024-11-12T10:30:00Z",
    "version_extractor": "2.1.0"
  }
}
```

---

## ğŸ¨ DISEÃ‘O UI DETALLADO

### **SECCIONES DEL PANEL DERECHO:**

#### **ğŸ“‹ 1. INFORMACIÃ“N DEL PROVEEDOR**
```html
â”Œâ”€ ğŸ¢ DATOS DEL PROVEEDOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Nombre: MADACO 2019, S.L.U.  [95%]       â”‚
â”‚ âš ï¸ CIF: B10824431              [70%] [âœï¸]   â”‚
â”‚ âœ… DirecciÃ³n: CL GESSAMÃ NÂº 13  [88%]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **ğŸ“„ 2. DATOS DE LA FACTURA**
```html
â”Œâ”€ ğŸ“„ INFORMACIÃ“N FISCAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ NÃºmero: FIRMA Y SELLO...    [65%] [âœï¸]   â”‚
â”‚ âœ… Fecha: 12/11/2024           [92%]        â”‚
â”‚ âŒ Vencimiento: No detectado   [0%]  [âœï¸]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **ğŸ’° 3. IMPORTES**
```html
â”Œâ”€ ğŸ’° IMPORTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Total: 1.534,39 â‚¬           [98%]        â”‚
â”‚ âœ… Base Imp.: 1.387,40 â‚¬       [88%]        â”‚
â”‚ âœ… IVA: 147,00 â‚¬               [85%]        â”‚
â”‚ âœ… Tipo IVA: 21%               [95%]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### **ğŸ“Š 4. RESUMEN GLOBAL**
```html
â”Œâ”€ ğŸ“Š CALIDAD DE EXTRACCIÃ“N â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Confianza Global: 85%          [ğŸŸ¡]         â”‚
â”‚ Campos Correctos: 6/8                       â”‚
â”‚ Requiere RevisiÃ³n: 2 campos                 â”‚
â”‚                                              â”‚
â”‚ [ğŸ’¾ Guardar Cambios] [ğŸ”„ Reprocesar]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ FLUJOS DE USUARIO MEJORADOS

### **ESCENARIO 1: Usuario revisa factura bien extraÃ­da**
1. **Dashboard** â†’ Click "ğŸ‘ï¸ Ver Factura"
2. **Modal se abre** â†’ Ve PDF + datos con âœ… verdes
3. **RevisiÃ³n rÃ¡pida** â†’ Todo correcto
4. **Cierra modal** â†’ Factura marcada como "Validada"

### **ESCENARIO 2: Usuario corrige errores**
1. **Modal abierto** â†’ Ve campos âš ï¸ amarillos y âŒ rojos
2. **Click campo rojo** â†’ Se abre editor inline
3. **Corrige valor** â†’ Auto-guardado + color cambia a âœ…
4. **Todos verdes** â†’ Factura marcada como "Corregida"

### **ESCENARIO 3: Usuario navega entre facturas**
1. **Modal con Factura A** â†’ BotÃ³n "Siguiente â†’"
2. **Carga Factura B** â†’ Sin cerrar modal
3. **Corrige campos** â†’ Auto-guardado
4. **"â† Anterior"** â†’ Vuelve a Factura A con cambios guardados

---

## ğŸ“ ARCHIVOS A CREAR

### **FRONTEND:**
```
/proyecto/
â”œâ”€â”€ dashboard-facturas.html        # Lista de facturas (MEJORAR)
â”œâ”€â”€ factura-viewer-modal.html      # Modal del visor (NUEVO)
â”œâ”€â”€ factura-viewer.js              # LÃ³gica del visor (NUEVO)
â”œâ”€â”€ factura-viewer.css             # Estilos modernos (NUEVO)
â””â”€â”€ pdf-renderer.js                # PDF.js + overlays (NUEVO)
```

### **BACKEND:**
```
/supabase/functions/
â”œâ”€â”€ get-factura-data/              # API datos factura (NUEVO)
â”œâ”€â”€ update-campo-factura/          # API guardar correcciÃ³n (NUEVO)
â””â”€â”€ validate-factura/              # API marcar como validada (NUEVO)
```

---

## âš¡ FUNCIONALIDADES TÃ‰CNICAS

### **1. RENDERIZADO PDF**
- **PDF.js**: LibrerÃ­a oficial de Mozilla
- **Canvas**: Para overlays de confianza
- **Zoom**: 50% a 300% con botones
- **Performance**: Lazy loading de pÃ¡ginas

### **2. SISTEMA DE EDICIÃ“N**
- **Inline editing**: Click para editar
- **ValidaciÃ³n**: Tiempo real por tipo de campo
- **Auto-guardado**: 2 segundos despuÃ©s de cambio
- **Feedback visual**: Spinner mientras guarda

### **3. NAVEGACIÃ“N**
- **Anterior/Siguiente**: Sin cerrar modal
- **Teclado**: â† â†’ para navegar, Esc para cerrar
- **URLs**: NavegaciÃ³n con historial del navegador

---

## ğŸ“± RESPONSIVE DESIGN

### **DESKTOP (>1024px):**
- Layout dual: PDF izquierda + datos derecha
- Ratio: 60% PDF / 40% datos
- Height: 90vh

### **TABLET (768px-1024px):**
- Layout dual ajustado: 50% / 50%
- Scrolling en panel de datos

### **MÃ“VIL (<768px):**
- PestaÃ±as: [ğŸ“„ PDF] [ğŸ“‹ Datos] [âš™ï¸ Config]
- Modal pantalla completa
- Swipe entre pestaÃ±as

---

## ğŸ¯ PLAN DE IMPLEMENTACIÃ“N

### **ğŸ”¥ FASE 1: ESTRUCTURA (DÃ­a 1)**
- [ ] Modal HTML con diseÃ±o base
- [ ] CSS responsive profesional
- [ ] IntegraciÃ³n con dashboard actual
- [ ] API bÃ¡sica get-factura-data

### **ğŸ“„ FASE 2: PDF VIEWER (DÃ­a 2)**
- [ ] IntegraciÃ³n PDF.js
- [ ] Controles de zoom
- [ ] NavegaciÃ³n pÃ¡ginas
- [ ] Loading states

### **ğŸ“ FASE 3: PANEL DE DATOS (DÃ­a 2-3)**
- [ ] Renderizado de campos por secciÃ³n
- [ ] Sistema de colores por confianza
- [ ] EdiciÃ³n inline de campos
- [ ] API update-campo-factura

### **âš¡ FASE 4: INTERACTIVIDAD (DÃ­a 3)**
- [ ] Auto-guardado
- [ ] NavegaciÃ³n entre facturas
- [ ] Atajos de teclado
- [ ] Estados de validaciÃ³n

### **ğŸ”§ FASE 5: OPTIMIZACIÃ“N (DÃ­a 4)**
- [ ] Performance improvements
- [ ] Testing responsive
- [ ] Overlays en PDF (futuro)
- [ ] Analytics de uso

---

## ğŸ“Š MÃ‰TRICAS DE Ã‰XITO

- âœ… **Tiempo de carga**: Modal abre en <1 segundo
- âœ… **Usabilidad**: Usuario puede revisar factura en <30 segundos
- âœ… **PrecisiÃ³n**: Sistema detecta errores visualmente al instante
- âœ… **Productividad**: 80% menos tiempo revisando facturas
- âœ… **SatisfacciÃ³n**: Interfaz profesional y fluida

---

**ğŸ¯ Prioridad:** ALTA - Mejora crÃ­tica de UX  
**â±ï¸ Tiempo estimado:** 3-4 dÃ­as  
**ğŸ”„ Iterativo:** Mejoras continuas segÃºn feedback  
**ğŸ“… Inicio:** Inmediato (ya tienes la base funcionando)