Â¡**PERFECTO**! Ya veo exactamente todos los campos que tienes. BasÃ¡ndome en las imÃ¡genes de tu tabla `datos_extraidos_facturas`, aquÃ­ estÃ¡n **TODOS los campos** para entrenar Document AI:

## ğŸ¯ **CAMPOS PARA ENTRENAR GOOGLE DOCUMENT AI**

### **ğŸ¢ DATOS DEL PROVEEDOR (8 campos):**
1. **proveedor_codigo_postal** â†’ `supplier_postal_code`
2. **proveedor_ciudad** â†’ `supplier_city`  
3. **proveedor_telefono** â†’ `supplier_phone`
4. **proveedor_email** â†’ `supplier_email`
5. **proveedor_web** â†’ `supplier_website`
6. **confianza_proveedor** â†’ `supplier_confidence` (se calcula automÃ¡ticamente)
7. supplier_bank_iban

### **ğŸ“‹ DATOS FISCALES (7 campos):**
7. **numero_factura** â†’ `invoice_number` â­ **CRÃTICO**
8. **fecha_factura** â†’ `invoice_date` â­ **CRÃTICO**
9. **fecha_vencimiento** â†’ `due_date`
10. **fecha_operacion** â†’ `operation_date`
11. **periodo_facturacion** â†’ `billing_period`
12. **numero_pedido** â†’ `purchase_order_number`
13. **numero_albaran_relacionado** â†’ `delivery_note_number`

### **ğŸ’° IMPORTES (8 campos principales):**
14. **base_imponible** â†’ `taxable_amount` â­ **CRÃTICO**
15. **total_factura** â†’ `total_amount` â­ **CRÃTICO**
16. **iva_tipos** â†’ `tax_breakdown` (JSONB - detalles de mÃºltiples IVAs)
17. **total_iva** â†’ `total_tax` â­ **CRÃTICO**
18. **retencion_irpf** â†’ `withholding_tax`
19. **porcentaje_retencion** â†’ `withholding_percentage`
20. **recargo_equivalencia** â†’ `equivalence_surcharge`
21. **total_descuentos** â†’ `total_discounts`

### **ğŸ“¦ ENTREGA Y LOGÃSTICA (5 campos):**
22. **direccion_entrega** â†’ `delivery_address`
23. **fecha_entrega** â†’ `delivery_date`
24. **transportista** â†’ `carrier`
25. **condiciones_pago** â†’ `payment_terms`
26. **metodo_pago_preferido** â†’ `preferred_payment_method`
27. **albranes_dentro_facturas_** related_delivery_note_number"

### **ğŸ“Š CAMPOS DE IVA DETALLADOS (2 campos):**
27. **cuota_iva** â†’ `tax_amount` â­ **CRÃTICO**
28. **tipo_iva** â†’ `tax_rate` â­ **CRÃTICO**

---

## â­ **CAMPOS MÃS CRÃTICOS PARA EMPEZAR (TOP 8):**

Si quieres empezar con lo esencial, entrena estos primero:

1. **invoice_number** (numero_factura)
2. **invoice_date** (fecha_factura)  
3. **total_amount** (total_factura)
4. **taxable_amount** (base_imponible)
5. **tax_amount** (cuota_iva)
6. **tax_rate** (tipo_iva)
7. **total_tax** (total_iva)
8. **supplier_name** (el que falta - proveedor_nombre)

## ğŸ¤– **CÃ“MO NOMBRAR EN DOCUMENT AI:**

**Usa nombres en inglÃ©s** para Document AI (mÃ¡s universal) y luego mapeas a tus campos en espaÃ±ol en la funciÃ³n.

Â¿Empezamos con estos 8 crÃ­ticos o prefieres configurar todos los 28 campos de una vez?// Pseudo-cÃ³digo para tu funciÃ³n
async function getOrCreateProveedor(restauranteId, datosProveedor) {
  // 1. Buscar si ya existe por CIF
  let proveedor = await buscarProveedorPorCIF(restauranteId, datosProveedor.cif)
  
  if (!proveedor) {
    // 2. Crear nuevo proveedor
    proveedor = await crearNuevoProveedor(restauranteId, datosProveedor)
  } else {
    // 3. Actualizar datos si han cambiado
    await actualizarProveedorSiNecesario(proveedor.id, datosProveedor)
  }
  
  return proveedor.id
}


âŒ ANTES (actual):
typescript// Solo guarda datos del proveedor como texto
.insert({
  documento_id: documentId,
  restaurante_id: documentInfo.restaurante_id,
  proveedor_nombre: extractedData.proveedor_nombre,
  proveedor_cif: extractedData.proveedor_cif,
  // ... resto
})
âœ… DESPUÃ‰S (necesario):
typescript// 1. Crear/encontrar proveedor
const proveedorId = await getOrCreateProveedor(restauranteId, datosProveedor)

// 2. Guardar factura con proveedor_id
.insert({
  documento_id: documentId,
  restaurante_id: documentInfo.restaurante_id,
  proveedor_id: proveedorId, // â¬…ï¸ NUEVO
  // ... resto SIN campos proveedor_*
})

// 3. Procesar productos y conectar con productos_maestro