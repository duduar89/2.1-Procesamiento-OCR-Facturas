ASO 5: Adaptar ExtracciÃ³n OpenAI
ğŸ“ DÃ³nde: En el prompt de OpenAI (lÃ­nea ~300)
Modificar prompt:
javascript// ANTES: prompt genÃ©rico
// DESPUÃ‰S: prompt especÃ­fico segÃºn tipo
const adaptedPrompt = adaptPromptForDocumentType(prompt, documentClassification.tipo)

PASO 6: Routing de InserciÃ³n
ğŸ“ DÃ³nde: Donde insertas en datos_extraidos_facturas (lÃ­nea ~800)
Reemplazar:
javascript// ANTES:
const { data: insertResult } = await supabaseClient
  .from('datos_extraidos_facturas')
  .insert(datosParaInsertar)

// DESPUÃ‰S:
const insertResult = await insertDocumentByType(
  supabaseClient, 
  datosParaInsertar, 
  documentClassification.tipo,
  documentId,
  documentInfo.restaurante_id
)

PASO 7: Actualizar Productos
ğŸ“ DÃ³nde: Al insertar en productos_extraidos (lÃ­nea ~900)
Agregar campo:
javascript// En productosParaInsertar, agregar:
tipo_documento: documentClassification.tipo

PASO 8: Funciones de NotificaciÃ³n
ğŸ“ DÃ³nde: Al final del archivo, antes del cierre
Agregar:

notifyForReview() - envÃ­a WhatsApp pidiendo revisiÃ³n
adaptPromptForDocumentType() - adapta prompt segÃºn tipo
insertDocumentByType() - inserta en tabla correcta


âœ… GarantÃ­as de No Romper Nada:

Si clasificaciÃ³n falla â†’ continÃºa como factura (comportamiento actual)
Si confianza alta â†’ flujo normal sin cambios
Campos opcionales â†’ no afectan inserciÃ³n existente
Tablas existentes â†’ misma estructura, solo routing diferente