Â¡Ah, perfecto! Te explico **exactamente** lo que necesitamos para las APIs:

## ğŸ”Œ **APIs - Lo que necesitamos**

### **Para cada API (Numier, Revel, etc.) necesitamos:**

#### **1. Credenciales de ConexiÃ³n**
```javascript
// NUMIER necesita:
{
  api_key: "Y8anMRi7qGmBt35xTgVeNvJ0WukF2KCw",
  base_url: "https://www.numier.com/api/public/index.php/api",
  tpv_ids: ["9763", "9764"] // IDs de las cajas registradoras
}

// REVEL necesitarÃ­a:
{
  api_key: "revel_key_123",
  api_secret: "revel_secret_456", 
  establishment_id: "12345"
}

// SQUARE necesitarÃ­a:
{
  access_token: "square_token_789",
  location_id: "L123ABC"
}
```

#### **2. ConfiguraciÃ³n de SincronizaciÃ³n**
```javascript
{
  sync_automatico: true,           // Â¿Sincronizar automÃ¡ticamente?
  sync_intervalo_horas: 6,         // Cada cuÃ¡nto sincronizar
  fecha_desde: "2025-01-01",       // Desde cuÃ¡ndo traer datos
  endpoints_activos: ["sales", "products"], // QuÃ© datos traer
  horario_sync: "02:00"           // A quÃ© hora del dÃ­a
}
```

#### **3. ConfiguraciÃ³n de Mapeo (igual que CSV)**
```javascript
// Porque cada API devuelve campos diferentes:

// NUMIER devuelve:
{
  "BusinessDay": "2025-01-15",
  "Totals.GrossAmount": 125.50,
  "Payments": "Efectivo"
}

// REVEL devolverÃ­a:
{
  "sale_date": "2025-01-15", 
  "total_amount": 125.50,
  "payment_type": "Cash"
}

// Necesitamos mapear:
NUMIER: "BusinessDay" â†’ fecha_venta
REVEL: "sale_date" â†’ fecha_venta

NUMIER: "Totals.GrossAmount" â†’ total_bruto  
REVEL: "total_amount" â†’ total_bruto
```

## ğŸ”§ **Lo que hay que crear:**

### **1. Configurador de API** (Frontend)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”Œ Configurar API                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tipo: [Numier â–¼]                  â”‚
â”‚  API Key: [___________________]     â”‚
â”‚  TPV IDs: [9763, 9764]             â”‚
â”‚  URL Base: [auto-completado]       â”‚
â”‚                                     â”‚
â”‚  ğŸ“Š ConfiguraciÃ³n Sync:             â”‚
â”‚  â˜‘ AutomÃ¡tico cada 6 horas         â”‚
â”‚  â˜‘ Traer ventas                    â”‚
â”‚  â˜‘ Traer productos                 â”‚
â”‚  Desde: [2024-01-01]               â”‚
â”‚                                     â”‚
â”‚  [ğŸ§ª Probar ConexiÃ³n]              â”‚
â”‚  [ğŸ’¾ Guardar ConfiguraciÃ³n]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. Mapeador de Campos de API**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ—ƒï¸ Mapear Campos - API Numier          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  API DEVUELVE:           MAPEAR A:      â”‚
â”‚  BusinessDay        â†’    fecha_venta    â”‚
â”‚  Totals.GrossAmount â†’    total_bruto    â”‚  
â”‚  Payments           â†’    metodo_pago    â”‚
â”‚  Pos.Id             â†’    tpv_id         â”‚
â”‚  NumDiners          â†’    num_comensales â”‚
â”‚                                         â”‚
â”‚  [ğŸ’¾ Guardar Mapeo] [ğŸ”„ Auto-detectar] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3. Edge Functions EspecÃ­ficas**

```typescript
// Para cada API:
// /functions/setup-numier-api/index.ts
// /functions/setup-revel-api/index.ts  
// /functions/setup-square-api/index.ts

// Universal:
// /functions/sync-all-apis/index.ts - Sincroniza todas las APIs activas
// /functions/configure-api-mapping/index.ts - Guarda mapeo de campos
```

## ğŸ“‹ **Tabla de ConfiguraciÃ³n Universal**

```sql
CREATE TABLE api_configuraciones (
  id UUID PRIMARY KEY,
  restaurante_id UUID,
  tipo_api VARCHAR(50),              -- 'numier', 'revel', 'square'
  credenciales JSONB,                -- API keys, URLs, etc.
  configuracion_sync JSONB,          -- CuÃ¡ndo y quÃ© sincronizar  
  mapeo_campos JSONB,                -- CÃ³mo mapear campos
  activo BOOLEAN DEFAULT true,
  ultima_sync TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);
```

## ğŸ”„ **Flujo Completo para APIs**

### **ConfiguraciÃ³n Inicial:**
```
1. Usuario selecciona tipo de API (Numier, Revel, etc.)
2. Introduce credenciales (API key, URLs, etc.)
3. Sistema hace peticiÃ³n de prueba
4. Muestra campos que devuelve la API
5. Usuario mapea campos a formato unificado
6. Se guarda todo en la tabla api_configuraciones
```

### **SincronizaciÃ³n AutomÃ¡tica:**
```
1. Edge Function corre cada X horas
2. Lee apis activas de cada restaurante
3. Para cada API:
   - Usa sus credenciales
   - Llama a sus endpoints
   - Aplica su mapeo de campos
   - Inserta en formato unificado
4. Log de resultados
```

## â“ **Â¿Te queda claro ahora?**

La diferencia principal es que:
- **CSV/Excel**: Usuario mapea campos **manualmente**
- **APIs**: Sistema mapea campos **automÃ¡ticamente** segÃºn configuraciÃ³n guardada

**Â¿Empezamos creando el configurador de APIs o tienes alguna duda?**